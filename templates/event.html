{% extends 'base.html' %}
{% block content %}
<section class="section">
  <h2>{{ e.title }}</h2>
  <p class="muted small">
    {{ e.date.strftime('%A, %B %d, %Y') if e.date else 'Date TBA' }} •
    {% if e.start_time %}{{ e.start_time.strftime('%H:%M') }}{% else %}Time TBA{% endif %}
    {% if e.end_time %} → {{ e.end_time.strftime('%H:%M') }}{% endif %}
    {% if not e.end_time and e.start_time %} • No specified end time{% endif %}
    {% if e.dry %} • Dry{% endif %}
    {% if e.capacity %} • Max: {{ e.capacity }}{% endif %}
  </p>
  <p>{{ e.description }}</p>
  <h3>Checklist</h3>
  {% if items %}
    <ul>
    {% for it in items %}
      <li>
        <form method="post" action="{{ url_for('toggle_item', event_id=e.id, item_id=it.id) }}" style="display:inline">
          {% if current_user.is_authenticated and current_user.id == e.creator_id %}
            <button class="btn small">{{ '✓' if it.checked else '○' }}</button>
          {% else %}
            <span class="pill">{{ '✓' if it.checked else '○' }}</span>
          {% endif %}
        </form>
        {{ it.label }}
      </li>
    {% endfor %}
    </ul>
  {% else %}
    <p class="muted">No items yet.</p>
  {% endif %}
  <h3>RSVP</h3>
  <p>Going: {{ yes }} • Maybe: {{ maybe }} • No: {{ no }}</p>
  {% if current_user.is_authenticated %}
    <form method="post" action="{{ url_for('rsvp', event_id=e.id, status='yes') }}" style="display:inline"><button class="btn small">Yes</button></form>
    <form method="post" action="{{ url_for('rsvp', event_id=e.id, status='maybe') }}" style="display:inline"><button class="btn small">Maybe</button></form>
    <form method="post" action="{{ url_for('rsvp', event_id=e.id, status='no') }}" style="display:inline"><button class="btn small">No</button></form>
    {% if current_user.id == e.creator_id %}
      <a class="btn ghost" href="{{ url_for('edit_event', event_id=e.id) }}">Edit</a>
      <form method="post" action="{{ url_for('delete_event', event_id=e.id) }}" style="display:inline" onsubmit="return confirm('Delete this event?')">
        <button class="btn danger small">Delete</button>
      </form>
    {% endif %}
  {% else %}
    <p class="muted small">Sign in to RSVP.</p>
  {% endif %}
</section>
{% endblock %}
